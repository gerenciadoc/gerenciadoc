<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciadoc.com - Cadastro</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #1E5BB8;
            --primary-white: #FFFFFF;
            --secondary-green: #28A745;
            --secondary-gray: #6C757D;
            --light-gray: #F8F9FA;
            --danger: #DC3545;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--light-gray);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            color: var(--primary-blue);
        }
        
        .btn-primary {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }
        
        .btn-primary:hover {
            background-color: #174a9c;
            border-color: #174a9c;
        }
        
        .register-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding: 2rem 0;
        }
        
        .register-form-container {
            background-color: var(--primary-white);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .trial-badge {
            background-color: var(--secondary-green);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 1rem;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--secondary-gray);
        }
        
        .form-control:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 0.2rem rgba(30, 91, 184, 0.25);
        }
        
        .progress-container {
            margin-bottom: 2rem;
        }
        
        .progress {
            height: 8px;
            background-color: #e9ecef;
        }
        
        .progress-bar {
            background-color: var(--primary-blue);
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
        }
        
        .step {
            font-size: 0.8rem;
            color: var(--secondary-gray);
        }
        
        .step.active {
            color: var(--primary-blue);
            font-weight: 600;
        }
        
        .alert {
            display: none;
            margin-bottom: 1rem;
        }
        
        .password-strength {
            height: 5px;
            transition: all 0.3s ease;
            margin-top: 5px;
        }
        
        .password-feedback {
            font-size: 0.8rem;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row register-container">
            <div class="col-md-8 col-lg-6 mx-auto">
                <div class="register-form-container">
                    <div class="logo">
                        <h1>Gerencia<span style="color: var(--primary-blue);">DOC</span></h1>
                        <div class="trial-badge">Teste Grátis por 5 dias</div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 33%;" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <div class="step-indicator">
                            <div class="step active">Dados Pessoais</div>
                            <div class="step">Dados da Empresa</div>
                            <div class="step">Confirmação</div>
                        </div>
                    </div>
                    
                    <div class="alert alert-danger" id="error-message" role="alert"></div>
                    <div class="alert alert-success" id="success-message" role="alert"></div>
                    
                    <form id="register-form">
                        <!-- Step 1: Dados Pessoais -->
                        <div id="step-1">
                            <h3 class="mb-4">Dados Pessoais</h3>
                            
                            <div class="mb-3">
                                <label for="name" class="form-label">Nome Completo</label>
                                <input type="text" class="form-control" id="name" name="name" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="email" class="form-label">Email Corporativo</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="password" class="form-label">Senha</label>
                                <input type="password" class="form-control" id="password" name="password" required>
                                <div class="password-strength"></div>
                                <div class="password-feedback text-muted"></div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="confirm-password" class="form-label">Confirmar Senha</label>
                                <input type="password" class="form-control" id="confirm-password" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="phone" class="form-label">Telefone</label>
                                <input type="tel" class="form-control" id="phone" name="phone">
                            </div>
                            
                            <div class="d-flex justify-content-end">
                                <button type="button" class="btn btn-primary" id="next-step-1">Próximo</button>
                            </div>
                        </div>
                        
                        <!-- Step 2: Dados da Empresa -->
                        <div id="step-2" style="display: none;">
                            <h3 class="mb-4">Dados da Empresa</h3>
                            
                            <div class="mb-3">
                                <label for="company-name" class="form-label">Nome da Empresa</label>
                                <input type="text" class="form-control" id="company-name" name="companyName" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="cnpj" class="form-label">CNPJ</label>
                                <input type="text" class="form-control" id="cnpj" name="cnpj" required>
                            </div>
                            
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="terms" required>
                                <label class="form-check-label" for="terms">Li e concordo com os <a href="#" target="_blank">Termos de Serviço</a> e <a href="#" target="_blank">Política de Privacidade</a></label>
                            </div>
                            
                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-secondary" id="prev-step-2">Voltar</button>
                                <button type="button" class="btn btn-primary" id="next-step-2">Próximo</button>
                            </div>
                        </div>
                        
                        <!-- Step 3: Confirmação -->
                        <div id="step-3" style="display: none;">
                            <h3 class="mb-4">Confirmação</h3>
                            
                            <p>Por favor, confirme seus dados antes de finalizar o cadastro:</p>
                            
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Dados Pessoais</h5>
                                    <p class="card-text"><strong>Nome:</strong> <span id="confirm-name"></span></p>
                                    <p class="card-text"><strong>Email:</strong> <span id="confirm-email"></span></p>
                                    <p class="card-text"><strong>Telefone:</strong> <span id="confirm-phone"></span></p>
                                    
                                    <h5 class="card-title mt-3">Dados da Empresa</h5>
                                    <p class="card-text"><strong>Empresa:</strong> <span id="confirm-company"></span></p>
                                    <p class="card-text"><strong>CNPJ:</strong> <span id="confirm-cnpj"></span></p>
                                </div>
                            </div>
                            
                            <div class="alert alert-info">
                                Ao finalizar o cadastro, você terá acesso gratuito por 5 dias a todas as funcionalidades do Gerenciadoc.
                            </div>
                            
                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-secondary" id="prev-step-3">Voltar</button>
                                <button type="submit" class="btn btn-success" id="submit-register">Finalizar Cadastro</button>
                            </div>
                        </div>
                    </form>
                    
                    <div class="text-center mt-4">
                        <p>Já tem uma conta? <a href="login.html">Faça login</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Auth Service -->
    <script src="js/auth.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se o usuário já está logado
            if (window.authService.isLoggedIn()) {
                // Redirecionar para o dashboard
                window.location.href = 'dashboard.html';
                return;
            }
            
            // Elementos do formulário
            const registerForm = document.getElementById('register-form');
            const errorMessage = document.getElementById('error-message');
            const successMessage = document.getElementById('success-message');
            
            // Elementos dos passos
            const step1 = document.getElementById('step-1');
            const step2 = document.getElementById('step-2');
            const step3 = document.getElementById('step-3');
            
            // Botões de navegação
            const nextStep1 = document.getElementById('next-step-1');
            const prevStep2 = document.getElementById('prev-step-2');
            const nextStep2 = document.getElementById('next-step-2');
            const prevStep3 = document.getElementById('prev-step-3');
            const submitRegister = document.getElementById('submit-register');
            
            // Barra de progresso
            const progressBar = document.querySelector('.progress-bar');
            const steps = document.querySelectorAll('.step');
            
            // Validação de senha
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirm-password');
            const passwordStrength = document.querySelector('.password-strength');
            const passwordFeedback = document.querySelector('.password-feedback');
            
            // Função para verificar força da senha
            passwordInput.addEventListener('input', function() {
                const password = this.value;
                let strength = 0;
                let feedback = '';
                
                if (password.length >= 8) strength += 1;
                if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength += 1;
                if (password.match(/\d/)) strength += 1;
                if (password.match(/[^a-zA-Z\d]/)) strength += 1;
                
                switch (strength) {
                    case 0:
                        passwordStrength.style.width = '0%';
                        passwordStrength.style.backgroundColor = '';
                        passwordFeedback.textContent = '';
                        break;
                    case 1:
                        passwordStrength.style.width = '25%';
                        passwordStrength.style.backgroundColor = '#dc3545';
                        passwordFeedback.textContent = 'Senha fraca';
                        passwordFeedback.style.color = '#dc3545';
                        break;
                    case 2:
                        passwordStrength.style.width = '50%';
                        passwordStrength.style.backgroundColor = '#ffc107';
                        passwordFeedback.textContent = 'Senha média';
                        passwordFeedback.style.color = '#ffc107';
                        break;
                    case 3:
                        passwordStrength.style.width = '75%';
                        passwordStrength.style.backgroundColor = '#28a745';
                        passwordFeedback.textContent = 'Senha forte';
                        passwordFeedback.style.color = '#28a745';
                        break;
                    case 4:
                        passwordStrength.style.width = '100%';
                        passwordStrength.style.backgroundColor = '#28a745';
                        passwordFeedback.textContent = 'Senha muito forte';
                        passwordFeedback.style.color = '#28a745';
                        break;
                }
            });
            
            // Navegação entre passos
            nextStep1.addEventListener('click', function() {
                // Validar campos do passo 1
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;
                
                if (!name || !email || !password || !confirmPassword) {
                    errorMessage.textContent = 'Por favor, preencha todos os campos obrigatórios.';
                    errorMessage.style.display = 'block';
                    return;
                }
                
                if (password !== confirmPassword) {
                    errorMessage.textContent = 'As senhas não coincidem.';
                    errorMessage.style.display = 'block';
                    return;
                }
                
                if (password.length < 8) {
                    errorMessage.textContent = 'A senha deve ter pelo menos 8 caracteres.';
                    errorMessage.style.display = 'block';
                    return;
                }
                
                // Esconder mensagens de erro
                errorMessage.style.display = 'none';
                
                // Avançar para o passo 2
                step1.style.display = 'none';
                step2.style.display = 'block';
                
                // Atualizar progresso
                progressBar.style.width = '66%';
                progressBar.setAttribute('aria-valuenow', '66');
                steps[0].classList.remove('active');
                steps[1].classList.add('active');
            });
            
            prevStep2.addEventListener('click', function() {
                // Voltar para o passo 1
                step2.style.display = 'none';
                step1.style.display = 'block';
                
                // Atualizar progresso
                progressBar.style.width = '33%';
                progressBar.setAttribute('aria-valuenow', '33');
                steps[1].classList.remove('active');
                steps[0].classList.add('active');
            });
            
            nextStep2.addEventListener('click', function() {
                // Validar campos do passo 2
                const companyName = document.getElementById('company-name').value;
                const cnpj = document.getElementById('cnpj').value;
                const terms = document.getElementById('terms').checked;
                
                if (!companyName || !cnpj) {
                    errorMessage.textContent = 'Por favor, preencha todos os campos obrigatórios.';
                    errorMessage.style.display = 'block';
                    return;
                }
                
                if (!terms) {
                    errorMessage.textContent = 'Você precisa aceitar os termos de serviço.';
                    errorMessage.style.display = 'block';
                    return;
                }
                
                // Esconder mensagens de erro
                errorMessage.style.display = 'none';
                
                // Preencher dados de confirmação
                document.getElementById('confirm-name').textContent = document.getElementById('name').value;
                document.getElementById('confirm-email').textContent = document.getElementById('email').value;
                document.getElementById('confirm-phone').textContent = document.getElementById('phone').value || 'Não informado';
                document.getElementById('confirm-company').textContent = companyName;
                document.getElementById('confirm-cnpj').textContent = cnpj;
                
                // Avançar para o passo 3
                step2.style.display = 'none';
                step3.style.display = 'block';
                
                // Atualizar progresso
                progressBar.style.width = '100%';
                progressBar.setAttribute('aria-valuenow', '100');
                steps[1].classList.remove('active');
                steps[2].classList.add('active');
            });
            
            prevStep3.addEventListener('click', function() {
                // Voltar para o passo 2
                step3.style.display = 'none';
                step2.style.display = 'block';
                
                // Atualizar progresso
                progressBar.style.width = '66%';
                progressBar.setAttribute('aria-valuenow', '66');
                steps[2].classList.remove('active');
                steps[1].classList.add('active');
            });
            
            // Submissão do formulário
            registerForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Limpar mensagens anteriores
                errorMessage.style.display = 'none';
                successMessage.style.display = 'none';
                
                // Obter dados do formulário
                const userData = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value,
                    companyName: document.getElementById('company-name').value,
                    cnpj: document.getElementById('cnpj').value,
                    phone: document.getElementById('phone').value
                };
                
                try {
                    // Mostrar indicador de carregamento
                    submitRegister.disabled = true;
                    submitRegister.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processando...';
                    
                    // Registrar usuário
                    const response = await window.authService.register(userData);
                    
                    // Mostrar mensagem de sucesso
                    successMessage.textContent = 'Cadastro realizado com sucesso! Redirecionando...';
                    successMessage.style.display = 'block';
                    
                    // Redirecionar para o dashboard após um breve delay
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1500);
                    
                } catch (error) {
                    // Mostrar mensagem de erro
                    errorMessage.textContent = error.message || 'Erro ao registrar usuário. Por favor, tente novamente.';
                    errorMessage.style.display = 'block';
                    
                    // Restaurar botão
                    submitRegister.disabled = false;
                    submitRegister.textContent = 'Finalizar Cadastro';
                    
                    // Voltar para o passo apropriado se o erro for relacionado a um campo específico
                    if (error.message && (error.message.includes('email') || error.message.includes('senha'))) {
                        step3.style.display = 'none';
                        step1.style.display = 'block';
                        progressBar.style.width = '33%';
                        progressBar.setAttribute('aria-valuenow', '33');
                        steps[2].classList.remove('active');
                        steps[0].classList.add('active');
                    } else if (error.message && (error.message.includes('CNPJ') || error.message.includes('empresa'))) {
                        step3.style.display = 'none';
                        step2.style.display = 'block';
                        progressBar.style.width = '66%';
                        progressBar.setAttribute('aria-valuenow', '66');
                        steps[2].classList.remove('active');
                        steps[1].classList.add('active');
                    }
                }
            });
        });
    </script>
</body>
</html>
